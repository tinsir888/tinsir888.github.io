<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>APS 重点复习课程之并行程序设计 | TINSIR888's ZION</title><meta name="keywords" content="留学,德国,APS,APS 重点复习课程,并行程序设计"><meta name="author" content="tinsir888"><meta name="copyright" content="tinsir888"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Overview Brief Introduction Parallel Algorithm Design and Analysis SIMD Pthread OpenMP MPI  Brief Introduction  Why Parallel Development of frequency: slow down, due to restriction of power and cooli">
<meta property="og:type" content="article">
<meta property="og:title" content="APS 重点复习课程之并行程序设计">
<meta property="og:url" content="https://tinsir888.github.io/posts/d5a99cbd.html">
<meta property="og:site_name" content="TINSIR888&#39;s ZION">
<meta property="og:description" content="Overview Brief Introduction Parallel Algorithm Design and Analysis SIMD Pthread OpenMP MPI  Brief Introduction  Why Parallel Development of frequency: slow down, due to restriction of power and cooli">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://tinsir888.github.io/img/aps.png">
<meta property="article:published_time" content="2022-10-21T22:00:00.000Z">
<meta property="article:modified_time" content="2022-12-13T14:36:16.067Z">
<meta property="article:author" content="tinsir888">
<meta property="article:tag" content="留学">
<meta property="article:tag" content="德国">
<meta property="article:tag" content="APS">
<meta property="article:tag" content="APS 重点复习课程">
<meta property="article:tag" content="并行程序设计">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tinsir888.github.io/img/aps.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://tinsir888.github.io/posts/d5a99cbd"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'APS 重点复习课程之并行程序设计',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2022-12-13 15:36:16'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-clock/lib/clock.min.css" /><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="TINSIR888's ZION" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">157</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">57</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">18</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/aps.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">TINSIR888's ZION</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">APS 重点复习课程之并行程序设计</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-10-21T22:00:00.000Z" title="Created 2022-10-22 00:00:00">2022-10-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-12-13T14:36:16.067Z" title="Updated 2022-12-13 15:36:16">2022-12-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%95%99%E5%AD%A6%E7%94%B3%E8%AF%B7/">留学申请</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%95%99%E5%AD%A6%E7%94%B3%E8%AF%B7/APS-%E5%AE%A1%E6%A0%B8%E5%A4%8D%E4%B9%A0/">APS 审核复习</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="APS 重点复习课程之并行程序设计"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="overview"><a class="markdownIt-Anchor" href="#overview"></a> Overview</h1>
<p>Brief Introduction</p>
<p>Parallel Algorithm Design and Analysis</p>
<p>SIMD</p>
<p>Pthread</p>
<p>OpenMP</p>
<p>MPI</p>
<h1 id="brief-introduction"><a class="markdownIt-Anchor" href="#brief-introduction"></a> Brief Introduction</h1>
<h2 id="why-parallel"><a class="markdownIt-Anchor" href="#why-parallel"></a> Why Parallel</h2>
<p>Development of frequency: slow down, due to restriction of power and cooling.</p>
<p>All computers are parallel computers.</p>
<h2 id="application-of-parallel-computing"><a class="markdownIt-Anchor" href="#application-of-parallel-computing"></a> Application of Parallel Computing</h2>
<p>Scientific simulation: climate modeling, Parallel Ocean Program, Biology informatics, medicine…</p>
<h2 id="super-computer-hardware"><a class="markdownIt-Anchor" href="#super-computer-hardware"></a> Super Computer Hardware</h2>
<p>Parallel architecture</p>
<p>von Neumann architecture</p>
<ul>
<li>temporal locality&amp;spatial locality</li>
<li>Lower memory access latency</li>
<li>pipeline, multiple launch, SIMD</li>
</ul>
<p>parallel control mechanism</p>
<ul>
<li>SIMD</li>
<li>MIMD</li>
<li>SPMD</li>
</ul>
<p>parallel architecture organization</p>
<ul>
<li>shard memory</li>
<li>distributed memory</li>
</ul>
<h2 id="software-technology"><a class="markdownIt-Anchor" href="#software-technology"></a> Software Technology</h2>
<p>sufficient concurrency (law of Amdahl)</p>
<p>concurrency granularity 并发力度</p>
<p>locality 局部性</p>
<p>load balancing 负载均衡</p>
<p>Coordination and Synchronization</p>
<h2 id="multi-coregpu"><a class="markdownIt-Anchor" href="#multi-coregpu"></a> Multi-core/GPU</h2>
<p>Tianhe-1A Tianhe-2</p>
<p>Nvidia 皮衣黄，黄狗</p>
<p>GPU vs CPU: GPU is throughput-orient, while CPU is latency-orient.</p>
<p>AMD Ryzen Zen3</p>
<p>ARM v8</p>
<h1 id="parallel-algorithm"><a class="markdownIt-Anchor" href="#parallel-algorithm"></a> Parallel Algorithm</h1>
<h2 id="design"><a class="markdownIt-Anchor" href="#design"></a> Design</h2>
<h3 id="task-decomposition-data-dependence-compete-condition"><a class="markdownIt-Anchor" href="#task-decomposition-data-dependence-compete-condition"></a> Task Decomposition, Data Dependence, Compete Condition</h3>
<p>Design</p>
<ul>
<li>Already know serial version, then implement a parallel version
<ul>
<li>Not sure to be best strategy: in some cases, best serial algorithm has nothing to do with best parallel algorithm</li>
</ul>
</li>
<li>Parallel algorithm strongly close to computer architecture!</li>
</ul>
<p>how to design?</p>
<ol>
<li>decompose computing task</li>
<li>keep dependence</li>
<li>try best to minimize extra cost</li>
</ol>
<p>If output rely on multi-incident’s sequence of time, then it exists race condition（竞争条件）.</p>
<p>Data dependence means in order to ensure the output correct, keep sequence of 2 storage operate.</p>
<p>Synchronization: serialize multi thread.</p>
<p>atomicity: a set of operations is either done all or not execute.</p>
<p>mutual exclusion: in any time only a thread running.</p>
<p>barrier: stop thread continuing until all thread has done.</p>
<h2 id="analysis"><a class="markdownIt-Anchor" href="#analysis"></a> Analysis</h2>
<h3 id="basic-indicators"><a class="markdownIt-Anchor" href="#basic-indicators"></a> Basic Indicators</h3>
<p>How to judge a serial algorithm: time/space complexity.</p>
<p>How to judge a parallel algorithm: number of processors, relative computing speed, communication speed.</p>
<h4 id="extra-cost"><a class="markdownIt-Anchor" href="#extra-cost"></a> Extra cost</h4>
<ul>
<li>communication between processes</li>
<li>process idle（进程空闲）</li>
<li>extra computing</li>
</ul>
<h4 id="performance-evaluation-criteria"><a class="markdownIt-Anchor" href="#performance-evaluation-criteria"></a> Performance Evaluation Criteria</h4>
<ul>
<li>Running Time
<ul>
<li>Serial: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>s</mi></msub></mrow><annotation encoding="application/x-tex">T_s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, from beginning to end.</li>
<li>Parallel: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>p</mi></msub></mrow><annotation encoding="application/x-tex">T_p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>, from beginning to the end of last process.</li>
</ul>
</li>
<li>Extra cost for Parallel
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>o</mi></msub><mo>=</mo><mi>p</mi><msub><mi>T</mi><mi>p</mi></msub><mo>−</mo><msub><mi>T</mi><mi>s</mi></msub></mrow><annotation encoding="application/x-tex">T_o=pT_p-T_s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">o</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord mathnormal">p</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
</ul>
</li>
<li>Speedup ratio: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mfrac><msub><mi>T</mi><mi>s</mi></msub><msub><mi>T</mi><mi>p</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">S=\frac{T_s}{T_p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.4307509999999999em;vertical-align:-0.5423199999999999em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8884309999999999em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285716em;"><span style="top:-2.357em;margin-left:-0.13889em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.13889em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5423199999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></li>
</ul>
<h3 id="scalability"><a class="markdownIt-Anchor" href="#scalability"></a> Scalability</h3>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mfrac><mi>S</mi><mi>P</mi></mfrac><mo>=</mo><mfrac><msub><mi>T</mi><mi>s</mi></msub><mrow><mi>p</mi><msub><mi>T</mi><mi>p</mi></msub></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><mfrac><msub><mi>T</mi><mi>o</mi></msub><msub><mi>T</mi><mi>s</mi></msub></mfrac></mrow></mfrac></mrow><annotation encoding="application/x-tex">E=\frac{S}{P}=\frac{T_s}{pT_p}=\frac{1}{1+\frac{T_o}{T_s}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.4307509999999999em;vertical-align:-0.5423199999999999em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8884309999999999em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285716em;"><span style="top:-2.357em;margin-left:-0.13889em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.13889em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5423199999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.664023em;vertical-align:-0.8189150000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.521885em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.95445em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.23056em;"><span style="top:-2.3em;margin-left:-0.13889em;margin-right:0.1em;"><span class="pstrut" style="height:2.5em;"></span><span class="mord mathnormal mtight">s</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.466357142857143em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.23056em;"><span style="top:-2.3em;margin-left:-0.13889em;margin-right:0.1em;"><span class="pstrut" style="height:2.5em;"></span><span class="mord mathnormal mtight">o</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4868571428571429em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8189150000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p>
<h1 id="simd"><a class="markdownIt-Anchor" href="#simd"></a> SIMD</h1>
<h2 id="serval-concepts"><a class="markdownIt-Anchor" href="#serval-concepts"></a> Serval Concepts</h2>
<p>Vector computer</p>
<p>SIMD</p>
<ul>
<li>Multi-media: SSE, AVX</li>
<li>Graphics processor: CUDA</li>
</ul>
<h3 id="application-of-simd"><a class="markdownIt-Anchor" href="#application-of-simd"></a> Application of SIMD</h3>
<ul>
<li>image process
<ul>
<li>3D game, movie</li>
<li>image identification</li>
<li>video encode/decode: jpeg, mpeg4</li>
</ul>
</li>
<li>audio
<ul>
<li>encode/decode: IP Phone, mp3</li>
<li>audio identification</li>
<li>DSP</li>
</ul>
</li>
<li>scientific computing</li>
</ul>
<h3 id="features-suitable-for-application"><a class="markdownIt-Anchor" href="#features-suitable-for-application"></a> Features suitable for Application</h3>
<ul>
<li>Regular data access patterns: continuous storage</li>
<li>short data: 8/16/32 bit</li>
<li>streaming data</li>
<li>in some cases:
<ul>
<li>lots of constant</li>
<li>short loop or iteration</li>
<li>arithmetic saturation 算术饱和</li>
</ul>
</li>
</ul>
<h2 id="problems-of-simd"><a class="markdownIt-Anchor" href="#problems-of-simd"></a> Problems of SIMD</h2>
<p>Multiple arithmetic→a SIMD operation</p>
<p>Multiple fetch/store operation→a wider storage operation</p>
<h3 id="complexity"><a class="markdownIt-Anchor" href="#complexity"></a> Complexity</h3>
<ul>
<li>High level: utilize compiler</li>
<li>Low level: intrinsic or assembly (cumbersome and error-prone)</li>
<li>Data must be align and continuous in storage
<ul>
<li>misaligned data may introduce wrong result.</li>
</ul>
</li>
<li>Control flow introduces more complexity, may cause inefficiency.</li>
</ul>
<h2 id="sseavx"><a class="markdownIt-Anchor" href="#sseavx"></a> SSE/AVX</h2>
<p>AMD&amp;Intel: x86 ISA support SIMD.</p>
<p>SSE</p>
<ul>
<li>
<p>Streaming-Single instruction multiple data Extensions, 1999</p>
</li>
<li>
<p>SSE2, 2001; SSE3, 2004; SSE4, 2007</p>
</li>
</ul>
<p>AVX</p>
<ul>
<li>Advanced Vector eXtensions, 2011</li>
<li>AVX2, 2013</li>
<li>AVX-512, 2017</li>
</ul>
<h3 id="sse-instructions"><a class="markdownIt-Anchor" href="#sse-instructions"></a> SSE instructions</h3>
<ul>
<li>Data move instruction: move in/out vector register</li>
<li>Arithmetic instruction: arithmetic operation on multiple data</li>
<li>Logic instruction: logic operation on multiple data</li>
<li>Compare instruction: compare on multiple data</li>
<li>Shuffle instruction: move data within vector register</li>
</ul>
<p>SSE instruction in C++: intrinsic</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;xmmintrin.h&gt;</span>  <span class="comment">//SSE</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;emmintrin.h&gt;</span>  <span class="comment">//SSE2</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pmmintrin.h&gt;</span> <span class="comment">//SSE3</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tmmintrin.h&gt;</span>  <span class="comment">//SSSE3</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;smmintrin.h&gt;</span> <span class="comment">//SSE4.1</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;nmmintrin.h&gt;</span>  <span class="comment">//SSSE4.2</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;immintrin.h&gt;</span> <span class="comment">//AVX、AVX2、AVX-512</span></span></span><br></pre></td></tr></table></figure>
<p>Compile option: <code>-march=corei7</code></p>
<p>Data type (map to XMM register)</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__m128<span class="comment">//float</span></span><br><span class="line">__m128d<span class="comment">//double</span></span><br><span class="line">__m128i<span class="comment">//integer</span></span><br></pre></td></tr></table></figure>
<p>Data move and initial</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_mm_load_ps, _mm_loadu_ps, _mm_load_pd, _mm_loadu_pd, etc</span><br><span class="line">_mm_store_ps<span class="comment">//und so weiter…</span></span><br><span class="line">_mm_setzero_ps</span><br></pre></td></tr></table></figure>
<p>Arithmetic intrinsics:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_mm_add_ss, _mm_add_ps<span class="comment">//und so weiter…</span></span><br><span class="line">_mm_add_pd, _mm_mul_pd</span><br><span class="line">_mm_hadd_ps<span class="comment">// [x4,x3,x2,x1][y4,y3,y2,y1] = [y3+y4, y1+y2, x3+x4, x1+x2]</span></span><br></pre></td></tr></table></figure>
<p>Logic: <code>_mm_and_ps</code> (andnot, or, xor)</p>
<p>Compare: <code>_mm_compeq_ps</code> result register all 0/1</p>
<p><code>_mm_comieq_ss</code> result in EFLAGS, return boolean</p>
<p>Prefetch intrinsics: <code>_mm_prefetch(char const *a, int sel)</code></p>
<h1 id="pthread"><a class="markdownIt-Anchor" href="#pthread"></a> Pthread</h1>
<h2 id="posix-thread"><a class="markdownIt-Anchor" href="#posix-thread"></a> POSIX Thread</h2>
<p>Pthreads are POSIX (Portable Operating System Interface for UNIX) compliant</p>
<h2 id="pthread-api"><a class="markdownIt-Anchor" href="#pthread-api"></a> Pthread API</h2>
<h3 id="fork-a-thread"><a class="markdownIt-Anchor" href="#fork-a-thread"></a> Fork a thread</h3>
<p><code>int pthread_create(pthread_t *,const pthread_attr_t *, void *(*)(void *), void *);</code></p>
<p>example: <code>errcode=pthread_create(&amp;thread_id,&amp;thread_attribute,&amp;thread_func, &amp;func_arg);</code></p>
<ul>
<li><code>thread_id</code> is ID of thread</li>
<li><code>thread_attribute</code> are attributes, <code>nullptr</code> means default attributes.</li>
<li><code>thread_func</code> means function to run</li>
<li><code>func_arg</code> means arguments for function</li>
<li><code>errcode</code> means if fail to fork, return a non-zero value.</li>
</ul>
<p>effect of <code>pthread_create</code>:</p>
<ul>
<li>create a new thread with the help of OS.</li>
<li>execute a certain function <code>thread_func</code></li>
</ul>
<p>a simple example:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="type">pthread_t</span> threads[<span class="number">16</span>];</span><br><span class="line">  <span class="type">int</span> tn;</span><br><span class="line">  <span class="keyword">for</span>(tn=<span class="number">0</span>; tn&lt;<span class="number">16</span>; tn++) &#123;</span><br><span class="line">    <span class="built_in">pthread_create</span>(&amp;threads[tn], <span class="literal">NULL</span>, ParFun, <span class="literal">NULL</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>(tn=<span class="number">0</span>; tn&lt;<span class="number">16</span> ; tn++) &#123;</span><br><span class="line">    <span class="built_in">pthread_join</span>(threads[tn], <span class="literal">NULL</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Global variables are shared.</p>
<p>Object arranged in heap may be shared.</p>
<p>Variables in stack are private.</p>
<h3 id="join"><a class="markdownIt-Anchor" href="#join"></a> Join</h3>
<p><code>int pthread_join(pthread_t *,void **value_ptr);</code></p>
<h3 id="other-apis"><a class="markdownIt-Anchor" href="#other-apis"></a> Other APIs</h3>
<p><code>void pthread_exit(void *value_ptr);</code> return result to callee through <code>value_ptr</code></p>
<p><code>int pthread_cancel(pthread_t thread);</code> cancel the exe of thread</p>
<p>Synchronization: busy-wait, mutex</p>
<h3 id="semaphore"><a class="markdownIt-Anchor" href="#semaphore"></a> semaphore</h3>
<p>aka 信号量</p>
<p>Initialize semaphore</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;semaphore.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sem_init</span><span class="params">(<span class="type">sem_t</span> *sem, <span class="type">int</span> pshared, <span class="type">unsigned</span> value)</span></span>;</span><br></pre></td></tr></table></figure>
<p><code>pshare</code>: non-zero for shared between process, zero for shared between thread in a process.</p>
<p>using semaphore</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">sem_wait</span><span class="params">(<span class="type">sem_t</span> *sem)</span></span>; <span class="comment">// sem decrease by 1, block if 0</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sem_post</span><span class="params">(<span class="type">sem_t</span> *sem)</span></span>; <span class="comment">// sem increase by 1, may wake if 0</span></span><br></pre></td></tr></table></figure>
<p>free semaphore</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">sem_destroy</span><span class="params">(<span class="type">sem_t</span> *sem)</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="barrier"><a class="markdownIt-Anchor" href="#barrier"></a> Barrier</h3>
<p>initialize barrier:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">pthread_barrier_t</span> b;</span><br><span class="line"><span class="built_in">pthread_barrier_init</span>(&amp;b,<span class="literal">NULL</span>,num_of_thread);</span><br></pre></td></tr></table></figure>
<p>the second arg means attributes of object, NULL if default.</p>
<p>wait for barrier:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">pthread_barrier_wait</span>(&amp;b);</span><br></pre></td></tr></table></figure>
<p>Assign a init val to initialize barrier:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PTHREAD_BARRIER_INITIALIZER</span>(num_of_thread)</span><br></pre></td></tr></table></figure>
<h3 id="mutex"><a class="markdownIt-Anchor" href="#mutex"></a> Mutex</h3>
<p>mutex means simply lock/unlock.</p>
<p>Take lots of OS resource.</p>
<p>API:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">pthread_cond_init</span>(condition, attr);</span><br><span class="line"><span class="built_in">pthread_cond_destory</span>(condition);</span><br><span class="line"><span class="built_in">pthread_condattr_init</span>(attr);</span><br><span class="line"><span class="built_in">pthread_condattr_destory</span>(attr);</span><br><span class="line"><span class="built_in">pthread_cond_wait</span>(condition, mutex);<span class="comment">//If the condition is not true, it will be blocked, and it was unlocked before</span></span><br><span class="line"><span class="built_in">pthread_cond_signal</span>(condition);<span class="comment">//Trigger condition, possibly waking up a blocked thread</span></span><br><span class="line"><span class="built_in">pthread_cond_broadcast</span>(condition);<span class="comment">//wake up multiple threads.</span></span><br></pre></td></tr></table></figure>
<h2 id="synchronization"><a class="markdownIt-Anchor" href="#synchronization"></a> Synchronization</h2>
<p>Due to modern OS features.</p>
<ul>
<li>Processor put memory-write operator in write-pipeline queue.</li>
<li>Merging “redundant” writes</li>
</ul>
<h3 id="basis"><a class="markdownIt-Anchor" href="#basis"></a> Basis</h3>
<p>2 basic operation</p>
<ul>
<li>Atomic Instruction Sequence</li>
<li>voluntary release execution</li>
</ul>
<h1 id="openmp"><a class="markdownIt-Anchor" href="#openmp"></a> OpenMP</h1>
<h2 id="openmp-parallel-model"><a class="markdownIt-Anchor" href="#openmp-parallel-model"></a> OpenMP Parallel Model</h2>
<p>A common alternative to Pthread, simpler but also more restrictive.</p>
<p>Portable</p>
<p>Scalable</p>
<p>Rely on Compiler</p>
<p>OpenMP can</p>
<ul>
<li>hide stack managing</li>
<li>provide synchronize mechanism</li>
</ul>
<p>OpenMP can not</p>
<ul>
<li>Auto - parallel</li>
<li>ensure acceleration</li>
<li>Avoid data competition</li>
</ul>
<p>OpenMP exe model</p>
<ul>
<li>Main thread</li>
<li>Start Parallel: main proc create a set of threads (work thread)</li>
<li>End Parallel: synchronization for thread set, latent barrier</li>
<li>main thread</li>
</ul>
<p>Compile instruction: <code>pragma</code></p>
<p>OpenMP:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _OPENMP</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;omp.h&gt;</span><span class="comment">// Header for OpenMP</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> bigdata[<span class="number">1024</span>];<span class="comment">//global shared</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(<span class="type">void</span> *bar)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> tid;<span class="comment">//private in-stack</span></span><br><span class="line">    <span class="meta">#<span class="keyword">pragma</span> omp parallel \</span></span><br><span class="line"><span class="meta">	shared ( bigdata ) \</span></span><br><span class="line"><span class="meta">	private ( tid )</span></span><br><span class="line">	&#123;</span><br><span class="line">	    <span class="comment">/* calc here. */</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Runtime seek function:</p>
<ul>
<li><code>int omp_get_num_threads(void);</code>: return number of threads in current parallel part.</li>
<li><code>int omp_get_thread_num(void);</code>: return id of current thread in current parallel part. Value is between 0 and <code>omp_get_num_threads()</code>-1.</li>
</ul>
<p>Parallel part</p>
<ul>
<li>
<p>multi-threads parallel execute code block</p>
</li>
<li>
<p>SPMD</p>
</li>
<li>
<p><code>#pragma omp directive_name[clause[clause]...]</code></p>
<p><code>//语句块</code></p>
</li>
<li>
<p>compile option: <code>gcc -fopenmp</code></p>
</li>
</ul>
<h2 id="loop-parallel"><a class="markdownIt-Anchor" href="#loop-parallel"></a> Loop Parallel</h2>
<p>Compiler’s duty:</p>
<ul>
<li>
<p>Each compile instruct begins with <code>#pragma</code></p>
</li>
<li>
<p>Computing loop scale for each thread</p>
</li>
<li>
<p>Manage data division</p>
</li>
<li>
<p>Auto barrier</p>
</li>
</ul>
<p>Restriction:</p>
<ul>
<li>loop should satisfy:
<ol>
<li>loop iterator is a signed integer</li>
<li>break check: [iterator] &lt;, &lt;=, &gt;, &gt;= [a constant]</li>
<li>for each iteration, loop iterator +1/-1</li>
<li>in the interior, not enter/exit control flow</li>
</ol>
</li>
<li>create thread, assign iteration among threads</li>
<li>iteration times must be predictable</li>
<li>do not check dependence!</li>
</ul>
<h2 id="data-dependence"><a class="markdownIt-Anchor" href="#data-dependence"></a> Data Dependence</h2>
<p>When will data dependence not happen?</p>
<blockquote>
<p>Bernstein condition (1966): <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">I_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> is a set of memory position read by process <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">P_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>O</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">O_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> is a set of memory position written by process <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">P_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>. Now concurrency <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">P_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">P_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>:</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mi>j</mi></msub><mo>⋂</mo><msub><mi>O</mi><mi>k</mi></msub><mo>=</mo><mi mathvariant="normal">∅</mi></mrow><annotation encoding="application/x-tex">I_j\bigcap O_k=\empty</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">⋂</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.80556em;vertical-align:-0.05556em;"></span><span class="mord">∅</span></span></span></span> write after read</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mi>k</mi></msub><mo>⋂</mo><msub><mi>I</mi><mi>j</mi></msub><mo>=</mo><mi mathvariant="normal">∅</mi></mrow><annotation encoding="application/x-tex">I_k\bigcap I_j=\empty</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">⋂</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.80556em;vertical-align:-0.05556em;"></span><span class="mord">∅</span></span></span></span> read after write</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>O</mi><mi>j</mi></msub><mo>⋂</mo><msub><mi>O</mi><mi>k</mi></msub><mo>=</mo><mi mathvariant="normal">∅</mi></mrow><annotation encoding="application/x-tex">O_j\bigcap O_k=\empty</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">⋂</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.80556em;vertical-align:-0.05556em;"></span><span class="mord">∅</span></span></span></span> write after write</li>
</ul>
</blockquote>
<h2 id="loop-scheduling"><a class="markdownIt-Anchor" href="#loop-scheduling"></a> Loop Scheduling</h2>
<p>Static Mapping: Data-orient mapping</p>
<p>z.B. Matrix (by row, by column, by block)</p>
<h2 id="locality"><a class="markdownIt-Anchor" href="#locality"></a> Locality</h2>
<p>Cost of parallel algorithm: arithmetic operations (FLOPS) and communication (moving data)</p>
<p>optimize memory level</p>
<ul>
<li>reduce memory visit latency</li>
<li>maximize memory bandwidth</li>
<li>control cost</li>
</ul>
<p>data reuse</p>
<ul>
<li>use same or adjacent data</li>
<li>innate feature of computing</li>
</ul>
<p>data locality</p>
<ul>
<li>data reuse, visit in “fast” memory</li>
<li>use same data or same data expression</li>
</ul>
<p>if reuse in computing, how can we get locality?</p>
<ul>
<li>suitable data layout</li>
<li>code rearrangement</li>
</ul>
<p>Unroll</p>
<h2 id="new-features-of-openmp"><a class="markdownIt-Anchor" href="#new-features-of-openmp"></a> New Features of OpenMP</h2>
<p>task-level parallel, atomic operation</p>
<p>SIMD, offload, thread bind, thread set</p>
<p>taskloop, target parallel</p>
<p>metadirective, flush, wider reduction</p>
<p>provider-consumer</p>
<h1 id="mpi"><a class="markdownIt-Anchor" href="#mpi"></a> MPI</h1>
<p>aka Massage Passing Interface</p>
<h2 id="basic-concepts-and-primitives"><a class="markdownIt-Anchor" href="#basic-concepts-and-primitives"></a> Basic Concepts and Primitives</h2>
<p>Message passing</p>
<p>Process is a PC + addr space, may contain serval threads.</p>
<p>Communication between processes is Message passing.</p>
<p>Message passing: synchronization and data moving.</p>
<h3 id="mpi-features"><a class="markdownIt-Anchor" href="#mpi-features"></a> MPI features</h3>
<ul>
<li>
<p>All Massage Passing and Synchronization rely on calling functions.</p>
<p>No shared variable</p>
</li>
<li>
<p>Provide functions as follow</p>
<ul>
<li>
<p>Communication</p>
<ul>
<li>P2P Communication</li>
<li>Group Communication</li>
</ul>
</li>
<li>
<p>Synchronization</p>
<ul>
<li>Barrier</li>
<li>Non-blocking</li>
</ul>
</li>
<li>
<p>Query</p>
<p>how many process? ID? Waiting?</p>
</li>
</ul>
</li>
</ul>
<h3 id="primitives"><a class="markdownIt-Anchor" href="#primitives"></a> Primitives</h3>
<p>To obtain basic info of runtime environment</p>
<ul>
<li>
<p>How many process involve?</p>
<p><code>int MPI_Comm_size(MPI_Comm comm,int *size);</code> reports numbers of process involve.</p>
</li>
<li>
<p>Who am I?</p>
<p><code>int MPI_Comm_rand(MPI_Comm comm,int *rank);</code> reports callee’s ID, ranging from 0 to size-1</p>
</li>
</ul>
<p>Compiling MPI in Linux:<code>mpicc -g -Wall -o &lt;runable file name&gt; &lt;src file name&gt;</code></p>
<p>Running MPI executable file: <code>mpiexec -n &lt;number of process&gt; &lt;runable file name&gt;</code></p>
<p>In Windows, download MSMPI to enable MPI environment.</p>
<h3 id="initialize-and-finalize"><a class="markdownIt-Anchor" href="#initialize-and-finalize"></a> Initialize and Finalize</h3>
<p><code>MPI_Init(int *argc_p,char ***argv_p);</code> Start essential initial work for MPI.</p>
<p><code>MPI_Finalize(void);</code> End MPI, clear.</p>
<h3 id="basic-mpi-program-structure"><a class="markdownIt-Anchor" href="#basic-mpi-program-structure"></a> Basic MPI Program Structure</h3>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span> </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="comment">/* This part shouldn&#x27;t call MPI */</span></span><br><span class="line">  <span class="built_in">MPI_Init</span>(&amp;argc, &amp;argv);</span><br><span class="line">  <span class="comment">/* MPI main body */</span></span><br><span class="line">  <span class="built_in">MPI_Finalize</span>();</span><br><span class="line">  <span class="comment">/* This part shouldn&#x27;t call MPI */</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="message-passing-in-mpi"><a class="markdownIt-Anchor" href="#message-passing-in-mpi"></a> Message Passing in MPI</h3>
<p>Process 0 <code>Send(data)</code> → Process 1 <code>Reveive(data)</code></p>
<p>Process and Communication Domain</p>
<p>Communication domain don’t have to contain all processes.</p>
<p>Each process in Communication domain has an ID “rank”.</p>
<p>A process in different communication domain may have different rank.</p>
<p>MPI (blocking) Send: <code>int MPI_Send(void* buf, int count, MPI_Datatype datatype, int dest, int tag, MPI_Comm comm);</code></p>
<ul>
<li>message buffer (<code>buf</code>, <code>count</code>, <code>datatype</code>)</li>
<li>target process <code>dest</code>: rank of target process in <code>comm</code> assigned domain</li>
<li>blocking send: when function returns, data has already submit to OS, but msg may haven’t reach to target.</li>
</ul>
<p>MPI (blocking) Receive: <code>int MPI_Recv(void* buf, int count, MPI_Datatype datatype, int source, int tag, MPI_Comm comm, MPI_Status *status);</code></p>
<ul>
<li>blocking receive: wait until receive matched msg (with same <code>source</code> and <code>tag</code>)</li>
<li><code>source</code> can be ID in <code>comm</code>, or <code>MPI_ANY_SOURCE</code></li>
<li><code>tag</code> are certain, or <code>MPI_ANY_TAG</code></li>
<li>It’s allowed that the amount of data are less than the assigned, but more than are ERROR.</li>
<li><code>status</code> contains more information.</li>
</ul>
<h3 id="mpi-datatype"><a class="markdownIt-Anchor" href="#mpi-datatype"></a> MPI Datatype</h3>
<ul>
<li>pre-define datatype correspond to high level language: <code>MPI_INT</code>, <code>MPI_DOUBLE</code></li>
<li>Continuous array of MPI datatype</li>
<li>Leap block of MPI datatype</li>
<li>Index array of MPI datatype</li>
<li>Any structure of MPI datatype</li>
</ul>
<p>A simple example:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;   </span><br><span class="line">  <span class="type">int</span> myid, namelen;</span><br><span class="line">  <span class="type">char</span> message[<span class="number">20</span>];</span><br><span class="line">  MPI_Status status;</span><br><span class="line">  <span class="type">char</span> processor_name[MPI_MAX_PROCESSOR_NAME];</span><br><span class="line">  <span class="built_in">MPI_Init</span>(&amp;argc,&amp;argv);</span><br><span class="line">  <span class="built_in">MPI_Comm_rank</span>(MPI_COMM_WORLD, &amp;myid);</span><br><span class="line">  <span class="built_in">MPI_Get_processor_name</span>(processor_name,&amp;namelen);</span><br><span class="line">  <span class="keyword">if</span>(myid == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">strcpy</span>(message,<span class="string">&quot; Hello process 1&quot;</span>);</span><br><span class="line">  	<span class="built_in">printf</span>(<span class="string">&quot;process 0 on %s send: %s\n&quot;</span>, </span><br><span class="line">      processor_name, message);</span><br><span class="line">    <span class="built_in">MPI_Send</span>(message, <span class="number">20</span>, MPI_CHAR, <span class="number">1</span>, <span class="number">99</span>,</span><br><span class="line">      MPI_COMM_WORLD);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (myid == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="built_in">MPI_Recv</span>(message, <span class="number">20</span>, MPI_CHAR, <span class="number">0</span>, <span class="number">99</span>,</span><br><span class="line">      MPI_COMM_WORLD, &amp;status);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;process 1 on %s received: %s\n&quot;</span>, </span><br><span class="line">      processor_name, message);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">MPI_Finalize</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="mpi-programming-model"><a class="markdownIt-Anchor" href="#mpi-programming-model"></a> MPI Programming Model</h2>
<p>Block Communication Pattern</p>
<p>It’s important to receive before sending for highest performance.</p>
<p>Internal completion is soon followed by return of <code>MPI_Recv</code>.</p>
<p>2 proc can’t receive and send at the same time. it may lead to dangerous communication or deadlock.</p>
<h2 id="collective-group-communication"><a class="markdownIt-Anchor" href="#collective-group-communication"></a> Collective (Group) Communication</h2>
<p>Communication, synchronization and computing</p>
<p>All process in a communication domain involved in communication at the same time.</p>
<p>Same function calling pattern</p>
<p>Context of collective communication is assigned by domain.</p>
<h3 id="broadcast-and-reduction"><a class="markdownIt-Anchor" href="#broadcast-and-reduction"></a> Broadcast and Reduction</h3>
<p>one-to-all broadcast</p>
<p><code>int MPI_Bcast(void* buffer, int count, MPI_Datatype datatype, int root, MPI_Comm comm);</code> root means the same sender, count means number of msgs waiting to broadcast.</p>
<ul>
<li>a process send same msg to other processes</li>
<li>at first, only source process have a m-byte msg; after broadcasting, all processes have same msg.</li>
</ul>
<p>all-to-one reduction</p>
<p><code>int MPI_Rduce(void* sendbuf, void* recvbuf, int count, MPI_Datatype datatype, MPI_Op op, int root, MPI_Comm comm);</code></p>
<ul>
<li>at first, all processes have a m-byte msg.</li>
<li>after reduction, p msgs become a data through calc, send to target process.</li>
</ul>
<p>all-to-all broadcast &amp; reduction</p>
<ul>
<li>application: matrix multiply, vector multiply from matrix.</li>
</ul>
<p>Group collect</p>
<p><code>int MPI_Allgather(void*sendbuf, int sendcount, MPI_Datatype sendtype, void* recvbuf, int recvcount, MPI_Datatype recvtype, MPI_Comm comm);</code> belongs to all2all broadcast</p>
<p>reduction then broadcast</p>
<p><code>int MPI_Reduce_scatter(void* sendbuf, void* recvbuf, int *recvcounts, MPI_Datatype datatype, MPI_Op op, MPI_Comm comm);</code> belongs to all2all reduction</p>
<p>All reduction</p>
<p><code>int MPI_Allreduce(void* sendbuf, void* recvbuf, int count, MPI_Datatype datatype, MPI_Op op, MPI_Comm comm);</code> equals to make each process as root to execute a same reduce operation.</p>
<p>Scan</p>
<p><code>int MPI_Scan(void* sendbuf, void* recvbuf, int count, MPI_Datatype datatype, MPI_Op op, MPI_Comm comm);</code> means each process put reduction operation on its last process.</p>
<ul>
<li>Prefix sum</li>
</ul>
<p>Scatter and Gather</p>
<ul>
<li>scatter: one-to-all, but different msg</li>
<li>gather: all-to-one, but different msg, no merge/reduction.</li>
</ul>
<p>All-to-all Individualized Communication</p>
<ul>
<li>all2all, but different msg.</li>
<li>application: FFT, matrix transpose, parallel database join.</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">MPI_Alltoall</span><span class="params">(<span class="type">void</span>* sendbuf, <span class="type">int</span> sendcount, MPI_Datatype sendtype, <span class="type">void</span>* recvbuf, <span class="type">int</span> recvcount, MPI_Datatype recvtype, MPI_Comm comm)</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">MPI_Alltoallv</span><span class="params">(<span class="type">void</span>* sendbuf, <span class="type">int</span> *sendcounts, <span class="type">int</span> *sdispls,MPI_Datatype sendtype, <span class="type">void</span>* recvbuf,<span class="type">int</span> *recvcounts, <span class="type">int</span> *rdispls,MPI_Datatype recvtype, MPI_Comm comm)</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="broadcast-algorithm"><a class="markdownIt-Anchor" href="#broadcast-algorithm"></a> Broadcast Algorithm</h3>
<h4 id="circlelinear"><a class="markdownIt-Anchor" href="#circlelinear"></a> Circle/Linear</h4>
<p>Naive Algorithm: send to p-1 in order. inefficient utilize of mesh.</p>
<p>Reduction Double:</p>
<ol>
<li>source P → P’</li>
<li>P, P’ → two other process</li>
</ol>
<p>in order to avoid conflict, introduce circle:</p>
<ol>
<li>P → the most distant process (p/2)</li>
<li>two process → two (p/4) processes</li>
</ol>
<h4 id="mesh"><a class="markdownIt-Anchor" href="#mesh"></a> Mesh</h4>
<p>A extension of linear broadcast</p>
<ol>
<li>broadcast by row</li>
<li>broadcast by column</li>
</ol>
<p>3D mesh</p>
<ul>
<li>each dimension has <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>p</mi><mfrac><mn>1</mn><mn>3</mn></mfrac></msup></mrow><annotation encoding="application/x-tex">p^{\frac{1}{3}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.14846em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9540200000000001em;"><span style="top:-3.363em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span></span></span></span> nodes.</li>
</ul>
<h2 id="non-blocking-communication"><a class="markdownIt-Anchor" href="#non-blocking-communication"></a> Non-blocking Communication</h2>
<p>Basic Meaning</p>
<ul>
<li>Callee return ≠ communication done</li>
</ul>
<p>Advantage</p>
<ul>
<li>overlap of computing and communication, time-saving</li>
</ul>
<p>Form</p>
<ul>
<li>non-blocking send &amp; receive</li>
</ul>
<p>Message passing and buffer</p>
<ul>
<li>send done only when buffer user provide can be reuse</li>
<li>send done not means receive done
<ul>
<li>msg may in OS buffer</li>
<li>msg may in transmission procedure</li>
</ul>
</li>
</ul>
<p>Difficulty of non-blocking</p>
<ul>
<li>OS
<ul>
<li>hardware should support in the backend, CPU is not involved.</li>
<li>corresponding API</li>
</ul>
</li>
<li>Algorithm
<ul>
<li>must ensure in the overlap, no dependency exists between computing and communication</li>
<li>in most cases need to reconstruct algorithm</li>
</ul>
</li>
</ul>
<p>… 不想复习了，40min 的 APS 其中 20 min 的面谈再怎么问也不可能问的这么细吧😲</p>
<h2 id="multi-thread-mix-programming"><a class="markdownIt-Anchor" href="#multi-thread-mix-programming"></a> Multi-thread Mix Programming</h2>
<p>Multi-core cluster common programming form:</p>
<ul>
<li>MPI only</li>
<li>MPI (among nodes)+OpenMP (within node)</li>
<li>MPI (among nodes)+Pthread (within node)</li>
</ul>
<p>the later 2 ways are called Mix Programming</p>
<p>… 不想复习了，爱咋咋地吧😢</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://tinsir888.github.io">tinsir888</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://tinsir888.github.io/posts/d5a99cbd.html">https://tinsir888.github.io/posts/d5a99cbd.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%95%99%E5%AD%A6/">留学</a><a class="post-meta__tags" href="/tags/%E5%BE%B7%E5%9B%BD/">德国</a><a class="post-meta__tags" href="/tags/APS/">APS</a><a class="post-meta__tags" href="/tags/APS-%E9%87%8D%E7%82%B9%E5%A4%8D%E4%B9%A0%E8%AF%BE%E7%A8%8B/">APS 重点复习课程</a><a class="post-meta__tags" href="/tags/%E5%B9%B6%E8%A1%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/">并行程序设计</a></div><div class="post_share"><div class="social-share" data-image="/img/aps.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/b11e128.html"><img class="prev-cover" src="/img/aps.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">APS 重点复习课程之操作系统</div></div></a></div><div class="next-post pull-right"><a href="/posts/9805f71d.html"><img class="next-cover" src="/img/aps.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">APS 重点复习课程之人工智能导论</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/posts/a37b98d7.html" title="APS 重点复习课程之软件工程"><img class="cover" src="/img/aps.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-28</div><div class="title">APS 重点复习课程之软件工程</div></div></a></div><div><a href="/posts/a942a1b8.html" title="APS 重点复习课程之深度学习及应用"><img class="cover" src="/img/aps.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-27</div><div class="title">APS 重点复习课程之深度学习及应用</div></div></a></div><div><a href="/posts/cad1b837.html" title="APS 重点复习课程之编译原理"><img class="cover" src="/img/aps.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-26</div><div class="title">APS 重点复习课程之编译原理</div></div></a></div><div><a href="/posts/28dbfae0.html" title="APS 重点复习课程之计算机网络"><img class="cover" src="/img/aps.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-25</div><div class="title">APS 重点复习课程之计算机网络</div></div></a></div><div><a href="/posts/551befad.html" title="APS 重点复习课程之汇编语言与逆向技术基础"><img class="cover" src="/img/aps.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-24</div><div class="title">APS 重点复习课程之汇编语言与逆向技术基础</div></div></a></div><div><a href="/posts/a346d5bd.html" title="APS 重点复习课程之计算机体系结构"><img class="cover" src="/img/aps.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-24</div><div class="title">APS 重点复习课程之计算机体系结构</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">tinsir888</div><div class="author-info__description">Willkommen bei tinsir888s Zion! :-)</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">157</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">57</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">18</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://www.github.com/tinsir888"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/tinsir888" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/smalltalk.odin@protonmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my personal Blog, I will update study notes and articles as I wish. ;-)</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#overview"><span class="toc-number">1.</span> <span class="toc-text"> Overview</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#brief-introduction"><span class="toc-number">2.</span> <span class="toc-text"> Brief Introduction</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#why-parallel"><span class="toc-number">2.1.</span> <span class="toc-text"> Why Parallel</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#application-of-parallel-computing"><span class="toc-number">2.2.</span> <span class="toc-text"> Application of Parallel Computing</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#super-computer-hardware"><span class="toc-number">2.3.</span> <span class="toc-text"> Super Computer Hardware</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#software-technology"><span class="toc-number">2.4.</span> <span class="toc-text"> Software Technology</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#multi-coregpu"><span class="toc-number">2.5.</span> <span class="toc-text"> Multi-core&#x2F;GPU</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#parallel-algorithm"><span class="toc-number">3.</span> <span class="toc-text"> Parallel Algorithm</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#design"><span class="toc-number">3.1.</span> <span class="toc-text"> Design</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#task-decomposition-data-dependence-compete-condition"><span class="toc-number">3.1.1.</span> <span class="toc-text"> Task Decomposition, Data Dependence, Compete Condition</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#analysis"><span class="toc-number">3.2.</span> <span class="toc-text"> Analysis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#basic-indicators"><span class="toc-number">3.2.1.</span> <span class="toc-text"> Basic Indicators</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#extra-cost"><span class="toc-number">3.2.1.1.</span> <span class="toc-text"> Extra cost</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#performance-evaluation-criteria"><span class="toc-number">3.2.1.2.</span> <span class="toc-text"> Performance Evaluation Criteria</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scalability"><span class="toc-number">3.2.2.</span> <span class="toc-text"> Scalability</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#simd"><span class="toc-number">4.</span> <span class="toc-text"> SIMD</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#serval-concepts"><span class="toc-number">4.1.</span> <span class="toc-text"> Serval Concepts</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#application-of-simd"><span class="toc-number">4.1.1.</span> <span class="toc-text"> Application of SIMD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#features-suitable-for-application"><span class="toc-number">4.1.2.</span> <span class="toc-text"> Features suitable for Application</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#problems-of-simd"><span class="toc-number">4.2.</span> <span class="toc-text"> Problems of SIMD</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#complexity"><span class="toc-number">4.2.1.</span> <span class="toc-text"> Complexity</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sseavx"><span class="toc-number">4.3.</span> <span class="toc-text"> SSE&#x2F;AVX</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sse-instructions"><span class="toc-number">4.3.1.</span> <span class="toc-text"> SSE instructions</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pthread"><span class="toc-number">5.</span> <span class="toc-text"> Pthread</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#posix-thread"><span class="toc-number">5.1.</span> <span class="toc-text"> POSIX Thread</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pthread-api"><span class="toc-number">5.2.</span> <span class="toc-text"> Pthread API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#fork-a-thread"><span class="toc-number">5.2.1.</span> <span class="toc-text"> Fork a thread</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#join"><span class="toc-number">5.2.2.</span> <span class="toc-text"> Join</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#other-apis"><span class="toc-number">5.2.3.</span> <span class="toc-text"> Other APIs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#semaphore"><span class="toc-number">5.2.4.</span> <span class="toc-text"> semaphore</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#barrier"><span class="toc-number">5.2.5.</span> <span class="toc-text"> Barrier</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mutex"><span class="toc-number">5.2.6.</span> <span class="toc-text"> Mutex</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#synchronization"><span class="toc-number">5.3.</span> <span class="toc-text"> Synchronization</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#basis"><span class="toc-number">5.3.1.</span> <span class="toc-text"> Basis</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#openmp"><span class="toc-number">6.</span> <span class="toc-text"> OpenMP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#openmp-parallel-model"><span class="toc-number">6.1.</span> <span class="toc-text"> OpenMP Parallel Model</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#loop-parallel"><span class="toc-number">6.2.</span> <span class="toc-text"> Loop Parallel</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#data-dependence"><span class="toc-number">6.3.</span> <span class="toc-text"> Data Dependence</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#loop-scheduling"><span class="toc-number">6.4.</span> <span class="toc-text"> Loop Scheduling</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#locality"><span class="toc-number">6.5.</span> <span class="toc-text"> Locality</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#new-features-of-openmp"><span class="toc-number">6.6.</span> <span class="toc-text"> New Features of OpenMP</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mpi"><span class="toc-number">7.</span> <span class="toc-text"> MPI</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#basic-concepts-and-primitives"><span class="toc-number">7.1.</span> <span class="toc-text"> Basic Concepts and Primitives</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mpi-features"><span class="toc-number">7.1.1.</span> <span class="toc-text"> MPI features</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#primitives"><span class="toc-number">7.1.2.</span> <span class="toc-text"> Primitives</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#initialize-and-finalize"><span class="toc-number">7.1.3.</span> <span class="toc-text"> Initialize and Finalize</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#basic-mpi-program-structure"><span class="toc-number">7.1.4.</span> <span class="toc-text"> Basic MPI Program Structure</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#message-passing-in-mpi"><span class="toc-number">7.1.5.</span> <span class="toc-text"> Message Passing in MPI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mpi-datatype"><span class="toc-number">7.1.6.</span> <span class="toc-text"> MPI Datatype</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mpi-programming-model"><span class="toc-number">7.2.</span> <span class="toc-text"> MPI Programming Model</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#collective-group-communication"><span class="toc-number">7.3.</span> <span class="toc-text"> Collective (Group) Communication</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#broadcast-and-reduction"><span class="toc-number">7.3.1.</span> <span class="toc-text"> Broadcast and Reduction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#broadcast-algorithm"><span class="toc-number">7.3.2.</span> <span class="toc-text"> Broadcast Algorithm</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#circlelinear"><span class="toc-number">7.3.2.1.</span> <span class="toc-text"> Circle&#x2F;Linear</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mesh"><span class="toc-number">7.3.2.2.</span> <span class="toc-text"> Mesh</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#non-blocking-communication"><span class="toc-number">7.4.</span> <span class="toc-text"> Non-blocking Communication</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#multi-thread-mix-programming"><span class="toc-number">7.5.</span> <span class="toc-text"> Multi-thread Mix Programming</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/1f9b131.html" title="算法博弈论 W38 Algorithmic mechanism design"><img src="/img/AUagt.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="算法博弈论 W38 Algorithmic mechanism design"/></a><div class="content"><a class="title" href="/posts/1f9b131.html" title="算法博弈论 W38 Algorithmic mechanism design">算法博弈论 W38 Algorithmic mechanism design</a><time datetime="2023-09-17T22:00:00.000Z" title="Created 2023-09-18 00:00:00">2023-09-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/732c15df.html" title="计算机视觉 W38 Convolutional Neural Networks"><img src="/img/AUcv.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算机视觉 W38 Convolutional Neural Networks"/></a><div class="content"><a class="title" href="/posts/732c15df.html" title="计算机视觉 W38 Convolutional Neural Networks">计算机视觉 W38 Convolutional Neural Networks</a><time datetime="2023-09-17T22:00:00.000Z" title="Created 2023-09-18 00:00:00">2023-09-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/973ad492.html" title="计算几何 W37 Sorting and Searching in Parallel"><img src="/img/AUcg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算几何 W37 Sorting and Searching in Parallel"/></a><div class="content"><a class="title" href="/posts/973ad492.html" title="计算几何 W37 Sorting and Searching in Parallel">计算几何 W37 Sorting and Searching in Parallel</a><time datetime="2023-09-11T22:00:00.000Z" title="Created 2023-09-12 00:00:00">2023-09-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/ef0daf6b.html" title="算法博弈论 W37 Myerson's lemma"><img src="/img/AUagt.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="算法博弈论 W37 Myerson's lemma"/></a><div class="content"><a class="title" href="/posts/ef0daf6b.html" title="算法博弈论 W37 Myerson's lemma">算法博弈论 W37 Myerson's lemma</a><time datetime="2023-09-10T22:00:00.000Z" title="Created 2023-09-11 00:00:00">2023-09-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/f0afc3ee.html" title="计算机视觉 W37 Neural Networks"><img src="/img/AUcv.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算机视觉 W37 Neural Networks"/></a><div class="content"><a class="title" href="/posts/f0afc3ee.html" title="计算机视觉 W37 Neural Networks">计算机视觉 W37 Neural Networks</a><time datetime="2023-09-10T22:00:00.000Z" title="Created 2023-09-11 00:00:00">2023-09-11</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/aps.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By tinsir888</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://npm.elemecdn.com/hexo-butterfly-clock/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_injector_config();
  }
  </script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax src="https://npm.elemecdn.com/hexo-butterfly-clock/lib/clock.min.js"></script><!-- hexo injector body_end end --></body></html>